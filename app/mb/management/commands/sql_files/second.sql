ALTER ALGORITHM = UNDEFINED DEFINER=`mb_dev`@`%` SQL SECURITY DEFINER VIEW `mb_view_master_trait_values` AS select `a`.`id` AS `id`,`a`.`master_id` AS `master_id`,`a`.`master_entity_name` AS `master_entity_name`,`a`.`master_attribute_id` AS `master_attribute_id`,`a`.`master_attribute_name` AS `master_attribute_name`,`a`.`traits_references` AS `traits_references`,`a`.`assigned_values` AS `assigned_values`,`a`.`n_distinct_value` AS `n_distinct_value`,`a`.`n_value` AS `n_value`,`a`.`n_supporting_value` AS `n_supporting_value`,`a`.`trait_values` AS `trait_values`,`a`.`trait_selected` AS `trait_selected`,`a`.`trait_references` AS `trait_references`,`a`.`value_percentage` AS `value_percentage` from (select row_number() over ( partition by `me`.`id`,`ma`.`id` order by `ma`.`name`,count(distinct `mr`.`citation`) desc,`mr`.`year` desc) AS `id`,`me`.`id` AS `master_id`,`me`.`name` AS `master_entity_name`,`ma`.`id` AS `master_attribute_id`,`ma`.`name` AS `master_attribute_name`,(select group_concat(distinct `mr2`.`citation` separator ',') from (((((((((`mb_masterentity` `me2` join `mb_entityrelation` `er2` on(`er2`.`master_entity_id` = `me2`.`id` and `me2`.`reference_id` = 4)) join `mb_sourcechoicesetoptionvalue` `scov2` on(`scov2`.`source_entity_id` = `er2`.`source_entity_id`)) join `mb_sourcechoicesetoption` `sco2` on(`scov2`.`source_choiceset_option_id` = `sco2`.`id`)) join `mb_choicesetoptionrelation` `cor2` on(`cor2`.`source_choiceset_option_id` = `sco2`.`id`)) join `mb_masterchoicesetoption` `mco2` on(`mco2`.`id` = `cor2`.`master_choiceset_option_id`)) join `mb_sourceentity` `se2` on(`se2`.`id` = `er2`.`source_entity_id`)) join `mb_sourcereference` `sr2` on(`se2`.`reference_id` = `sr2`.`id`)) join `mb_masterreference` `mr2` on(`mr2`.`id` = `sr2`.`master_reference_id`)) join `mb_masterattribute` `ma2` on(`ma2`.`id` = `mco2`.`master_attribute_id`)) where `me2`.`id` = `me`.`id` and `ma2`.`id` = `ma`.`id` and `mco2`.`name` <> '-Undefined' group by `me2`.`id`,`ma2`.`id` order by count(distinct `mr2`.`citation`) desc) AS `traits_references`,(select group_concat(`mco2`.`name` order by `mco2`.`name` ASC separator ',') from (((((((((`mb_masterentity` `me2` join `mb_entityrelation` `er2` on(`er2`.`master_entity_id` = `me2`.`id` and `me2`.`reference_id` = 4)) join `mb_sourcechoicesetoptionvalue` `scov2` on(`scov2`.`source_entity_id` = `er2`.`source_entity_id`)) join `mb_sourcechoicesetoption` `sco2` on(`scov2`.`source_choiceset_option_id` = `sco2`.`id`)) join `mb_choicesetoptionrelation` `cor2` on(`cor2`.`source_choiceset_option_id` = `sco2`.`id`)) join `mb_masterchoicesetoption` `mco2` on(`mco2`.`id` = `cor2`.`master_choiceset_option_id`)) join `mb_sourceentity` `se2` on(`se2`.`id` = `er2`.`source_entity_id`)) join `mb_sourcereference` `sr2` on(`se2`.`reference_id` = `sr2`.`id`)) join `mb_masterreference` `mr2` on(`mr2`.`id` = `sr2`.`master_reference_id`)) join `mb_masterattribute` `ma2` on(`ma2`.`id` = `mco2`.`master_attribute_id`)) where `me2`.`id` = `me`.`id` and `ma2`.`id` = `ma`.`id` and `mco2`.`name` <> '-Undefined' group by `me2`.`id`,`ma2`.`id` order by count(distinct `mr2`.`citation`) desc) AS `assigned_values`,(select count(distinct `mco2`.`name`) from (((((((((`mb_masterentity` `me2` join `mb_entityrelation` `er2` on(`er2`.`master_entity_id` = `me2`.`id` and `me2`.`reference_id` = 4)) join `mb_sourcechoicesetoptionvalue` `scov2` on(`scov2`.`source_entity_id` = `er2`.`source_entity_id`)) join `mb_sourcechoicesetoption` `sco2` on(`scov2`.`source_choiceset_option_id` = `sco2`.`id`)) join `mb_choicesetoptionrelation` `cor2` on(`cor2`.`source_choiceset_option_id` = `sco2`.`id`)) join `mb_masterchoicesetoption` `mco2` on(`mco2`.`id` = `cor2`.`master_choiceset_option_id`)) join `mb_sourceentity` `se2` on(`se2`.`id` = `er2`.`source_entity_id`)) join `mb_sourcereference` `sr2` on(`se2`.`reference_id` = `sr2`.`id`)) join `mb_masterreference` `mr2` on(`mr2`.`id` = `sr2`.`master_reference_id`)) join `mb_masterattribute` `ma2` on(`ma2`.`id` = `mco2`.`master_attribute_id`)) where `me2`.`id` = `me`.`id` and `ma2`.`id` = `ma`.`id` and `mco2`.`name` <> '-Undefined' group by `me2`.`id`,`ma2`.`id` order by count(distinct `mr2`.`citation`) desc) AS `n_distinct_value`,(select count(`mco2`.`name`) from (((((((((`mb_masterentity` `me2` join `mb_entityrelation` `er2` on(`er2`.`master_entity_id` = `me2`.`id` and `me2`.`reference_id` = 4)) join `mb_sourcechoicesetoptionvalue` `scov2` on(`scov2`.`source_entity_id` = `er2`.`source_entity_id`)) join `mb_sourcechoicesetoption` `sco2` on(`scov2`.`source_choiceset_option_id` = `sco2`.`id`)) join `mb_choicesetoptionrelation` `cor2` on(`cor2`.`source_choiceset_option_id` = `sco2`.`id`)) join `mb_masterchoicesetoption` `mco2` on(`mco2`.`id` = `cor2`.`master_choiceset_option_id`)) join `mb_sourceentity` `se2` on(`se2`.`id` = `er2`.`source_entity_id`)) join `mb_sourcereference` `sr2` on(`se2`.`reference_id` = `sr2`.`id`)) join `mb_masterreference` `mr2` on(`mr2`.`id` = `sr2`.`master_reference_id`)) join `mb_masterattribute` `ma2` on(`ma2`.`id` = `mco2`.`master_attribute_id`)) where `me2`.`id` = `me`.`id` and `ma2`.`id` = `ma`.`id` and `mco2`.`name` <> '-Undefined' group by `me2`.`id`,`ma2`.`id` order by count(distinct `mr2`.`citation`) desc) AS `n_value`,count(`mco`.`name`) AS `n_supporting_value`,(select group_concat(distinct `mco2`.`name` separator ',') from (((((((((`mb_masterentity` `me2` join `mb_entityrelation` `er2` on(`er2`.`master_entity_id` = `me2`.`id` and `me2`.`reference_id` = 4)) join `mb_sourcechoicesetoptionvalue` `scov2` on(`scov2`.`source_entity_id` = `er2`.`source_entity_id`)) join `mb_sourcechoicesetoption` `sco2` on(`scov2`.`source_choiceset_option_id` = `sco2`.`id`)) join `mb_choicesetoptionrelation` `cor2` on(`cor2`.`source_choiceset_option_id` = `sco2`.`id`)) join `mb_masterchoicesetoption` `mco2` on(`mco2`.`id` = `cor2`.`master_choiceset_option_id`)) join `mb_sourceentity` `se2` on(`se2`.`id` = `er2`.`source_entity_id`)) join `mb_sourcereference` `sr2` on(`se2`.`reference_id` = `sr2`.`id`)) join `mb_masterreference` `mr2` on(`mr2`.`id` = `sr2`.`master_reference_id`)) join `mb_masterattribute` `ma2` on(`ma2`.`id` = `mco2`.`master_attribute_id`)) where `me2`.`id` = `me`.`id` and `ma2`.`id` = `ma`.`id` and `mco2`.`name` <> '-Undefined' group by `me2`.`id`,`ma2`.`id` order by count(distinct `mr2`.`citation`) desc) AS `trait_values`,group_concat(distinct `mco`.`name` separator ',') AS `trait_selected`,group_concat(distinct `mr`.`citation` separator ',') AS `trait_references`,count(`mco`.`name`) / (select count(`mco2`.`name`) from (((((((((`mb_masterentity` `me2` join `mb_entityrelation` `er2` on(`er2`.`master_entity_id` = `me2`.`id` and `me2`.`reference_id` = 4)) join `mb_sourcechoicesetoptionvalue` `scov2` on(`scov2`.`source_entity_id` = `er2`.`source_entity_id`)) join `mb_sourcechoicesetoption` `sco2` on(`scov2`.`source_choiceset_option_id` = `sco2`.`id`)) join `mb_choicesetoptionrelation` `cor2` on(`cor2`.`source_choiceset_option_id` = `sco2`.`id`)) join `mb_masterchoicesetoption` `mco2` on(`mco2`.`id` = `cor2`.`master_choiceset_option_id`)) join `mb_sourceentity` `se2` on(`se2`.`id` = `er2`.`source_entity_id`)) join `mb_sourcereference` `sr2` on(`se2`.`reference_id` = `sr2`.`id`)) join `mb_masterreference` `mr2` on(`mr2`.`id` = `sr2`.`master_reference_id`)) join `mb_masterattribute` `ma2` on(`ma2`.`id` = `mco2`.`master_attribute_id`)) where `me2`.`id` = `me`.`id` and `ma2`.`id` = `ma`.`id` and `mco2`.`name` <> '-Undefined' group by `me2`.`id`,`ma2`.`id` order by count(distinct `mr2`.`citation`) desc) AS `value_percentage` from (((((((((`mb_masterentity` `me` join `mb_entityrelation` `er` on(`er`.`master_entity_id` = `me`.`id` and `me`.`reference_id` = 4)) join `mb_sourcechoicesetoptionvalue` `scov` on(`scov`.`source_entity_id` = `er`.`source_entity_id`)) join `mb_sourcechoicesetoption` `sco` on(`scov`.`source_choiceset_option_id` = `sco`.`id`)) join `mb_choicesetoptionrelation` `cor` on(`cor`.`source_choiceset_option_id` = `sco`.`id`)) join `mb_masterchoicesetoption` `mco` on(`mco`.`id` = `cor`.`master_choiceset_option_id`)) join `mb_sourceentity` `se` on(`se`.`id` = `er`.`source_entity_id`)) join `mb_sourcereference` `sr` on(`se`.`reference_id` = `sr`.`id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_masterattribute` `ma` on(`ma`.`id` = `mco`.`master_attribute_id`)) where `mco`.`name` <> '-Undefined' group by `me`.`id`,`ma`.`id`,`mco`.`id` order by `ma`.`name`) `a` where `a`.`id` = 1 ;
ALTER ALGORITHM = UNDEFINED DEFINER=`mb_dev`@`%` SQL SECURITY DEFINER VIEW `mb_view_pa_table` AS select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',1),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',1),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 1 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',1),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',2),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',2),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 2 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',2),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',3),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',3),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 3 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',3),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',4),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',4),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 4 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',4),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',5),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',5),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 5 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',5),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',6),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',6),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 6 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',6),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',7),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',7),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 7 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',7),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',8),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',8),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 8 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',8),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',9),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',9),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 9 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',9),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',10),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',10),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 10 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',10),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',11),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',11),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 11 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',11),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',12),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',12),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 12 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',12),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',13),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',13),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 13 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',13),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',14),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',14),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 14 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',14),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',15),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',15),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 15 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',15),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',16),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',16),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 16 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',16),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',17),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',17),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 17 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',17),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',18),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',18),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 18 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',18),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',19),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',19),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 19 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',19),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',20),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',20),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 20 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',20),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',21),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',21),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 21 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',21),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',22),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',21),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 22 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',22),'-',-1),`part`.`caption` union select 1 AS `id`,1 AS `tsn`,'MINERAL' AS `hierarchy`,'MINERAL' AS `part`,0 AS `cp_std`,0 AS `ee_std`,0 AS `cf_std`,100 AS `ash_std`,0 AS `nfe_std`,0 AS `reference_ids`,0 AS `n_taxa`,0 AS `n_reference`,0 AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',1),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 1 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',1),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',2),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',2),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 2 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',2),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',3),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',3),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 3 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',3),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',4),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',4),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 4 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',4),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',5),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',5),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 5 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',5),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',6),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',6),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 6 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',6),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',7),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',7),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 7 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',7),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',8),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',8),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 8 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',8),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',9),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',9),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 9 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',9),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',10),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',10),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 10 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',10),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',11),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',11),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 11 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',11),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',12),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',12),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 12 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',12),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',13),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',13),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 13 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',13),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',14),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',14),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 14 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',14),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',15),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',15),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 15 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',15),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',16),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',16),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 16 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',16),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',17),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',17),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 17 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',17),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',18),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',18),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 18 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',18),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',19),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',19),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 19 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',19),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',20),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',20),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 20 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',20),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',21),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',21),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 21 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',21),'-',-1),`part`.`caption` union select 1 AS `id`,substring_index(substring_index(`tu`.`hierarchy_string`,'-',22),'-',-1) AS `tsn`,`tu2`.`hierarchy` AS `hierarchy`,`part`.`caption` AS `part`,avg(`pai`.`cp_std`) AS `cp_std`,avg(`pai`.`ee_std`) AS `ee_std`,avg(`pai`.`cf_std`) AS `cf_std`,avg(`pai`.`ash_std`) AS `ash_std`,avg(`pai`.`nfe_std`) AS `nfe_std`,group_concat(distinct `mr`.`id` separator ',') AS `reference_ids`,count(distinct ifnull(`sl`.`tsn_accepted`,`tu`.`tsn`)) AS `n_taxa`,count(distinct `mr`.`id`) AS `n_reference`,count(distinct `pa`.`id`) AS `n_analysis` from ((((((((`mb_proximateanalysisitem` `pai` join `mb_proximateanalysis` `pa` on(`pa`.`id` = `pai`.`proximate_analysis_id`)) join `mb_sourcereference` `sr` on(`sr`.`id` = `pa`.`reference_id`)) join `mb_masterreference` `mr` on(`mr`.`id` = `sr`.`master_reference_id`)) join `mb_fooditem` `forage` on(`forage`.`id` = `pai`.`forage_id` and `forage`.`is_cultivar` = 0)) join `itis_taxonomicunits` `tu` on(`tu`.`tsn` = `forage`.`tsn`)) left join `itis_synonymlinks` `sl` on(`sl`.`tsn` = `tu`.`tsn`)) join `mb_choicevalue` `part` on(`part`.`id` = `forage`.`part_id`)) left join `itis_taxonomicunits` `tu2` on(`tu2`.`tsn` = substring_index(substring_index(`tu`.`hierarchy_string`,'-',21),'-',-1))) where `part`.`caption` <> 'NONE' and round((octet_length(`tu`.`hierarchy`) - octet_length(replace(`tu`.`hierarchy`,'-',''))) / octet_length('-'),0) + 1 >= 22 group by substring_index(substring_index(`tu`.`hierarchy_string`,'-',22),'-',-1),`part`.`caption` order by `id`,`part`,`hierarchy` ;
